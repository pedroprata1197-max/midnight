<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Midnight Lashes</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Raleway:wght@300;500;700&display=swap" rel="stylesheet">

<!-- FullCalendar -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>

<style>
body { font-family: 'Raleway', sans-serif; background: linear-gradient(to bottom, #fdf6ec, #fff3e8); color: #4b3a2f; margin:0; padding:0; display:flex; justify-content:center; }
.container { max-width: 1000px; background-color: #fff8f0; padding:40px; border-radius:25px; box-shadow:0 10px 40px rgba(0,0,0,0.08); margin-top:20px; }
h1 { font-family:'Dancing Script', cursive; text-align:center; color:#d4af37; margin-bottom:25px; font-size:3rem; }
button,input,select{ font-size:1rem; border-radius:10px; padding:10px; border:2px solid #d4af37; margin-bottom:12px; width:100%; }
button{ background-color:#d4af37; color:white; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover{ background-color:#e6c965; color:#4b3a2f; }
#calendar{ max-width:100%; margin:20px auto; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.05); }
.agendamento-pendente{ border-bottom:1px solid #d4af37; padding:12px 0; }
.agendamento-pendente button{ width:48%; margin-right:2%; display:inline-block; }
.modal{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content{ background:#fff8f0; padding:25px; border-radius:15px; max-width:400px; width:90%; }
.modal h2{ font-family:'Dancing Script', cursive; color:#d4af37; margin-bottom:15px; }
</style>
</head>
<body>

<div class="container" id="login-container">
<h1>Admin Login</h1>
<input type="password" id="senha" placeholder="Senha de Administrador">
<button onclick="verificarSenha()">Entrar</button>
<p id="mensagem"></p>
</div>

<div class="container" id="admin-panel" style="display:none;">
<h1>Painel de Administração</h1>

<h2>Agendamentos Pendentes</h2>
<div id="pendentes"></div>

<h2>Calendário de Agendamentos</h2>
<div id="calendar"></div>

<h2>Bloquear Horários / Dias</h2>
<label>Data:</label>
<input type="date" id="data-bloqueio">
<label>Hora:</label>
<select id="hora-bloqueio"></select>
<button onclick="bloquearHorario()">Bloquear Horário</button>
<button onclick="desbloquearHorario()">Desbloquear Horário</button>
<button onclick="bloquearDiaInteiro()">Bloquear Dia Inteiro</button>
</div>

<!-- Modal de edição -->
<div class="modal" id="modal-editar">
<div class="modal-content">
<h2>Editar Agendamento</h2>
<input type="text" id="editar-nome" placeholder="Nome">
<input type="text" id="editar-contato" placeholder="Contacto">
<input type="email" id="editar-email" placeholder="Email">
<input type="date" id="editar-data">
<input type="time" id="editar-hora">
<button onclick="salvarEdicao()">Salvar</button>
<button onclick="fecharModal()">Cancelar</button>
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey:"SUA_API_KEY_AQUI",
  authDomain:"midnighlashes.firebaseapp.com",
  projectId:"midnighlashes",
  storageBucket:"midnighlashes.firebasestorage.app",
  messagingSenderId:"811371305708",
  appId:"1:811371305708:web:b857bdf2a19fa704f8a3c9",
  measurementId:"G-9PEQLQKCWC"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let calendar;
let editarDocId=null;

// Login
function verificarSenha(){
  const senha=document.getElementById('senha').value;
  if(senha==="Yoshi2022"){
    document.getElementById('login-container').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    carregarAgendamentosPendentes();
    gerarHorariosBloqueio();
    carregarEventosCalendario();
  }else document.getElementById('mensagem').innerText="Senha incorreta!";
}

// Carregar pendentes
function carregarAgendamentosPendentes(){
  const div=document.getElementById('pendentes');
  db.collection("agendamentos").where("status","==","pendente_pagamento").onSnapshot(snapshot=>{
    div.innerHTML="";
    snapshot.forEach(doc=>{
      const ag=doc.data();
      const item=document.createElement('div');
      item.className="agendamento-pendente";
      item.innerHTML=`<strong onclick="abrirModal('${doc.id}','${ag.nome}','${ag.contato}','${ag.email}','${ag.data}','${ag.hora}')">${ag.nome}</strong> (${ag.contato})<br>
      ${ag.servico}<br>${ag.data} ${ag.hora}<br>${ag.email}<br><br>
      <button onclick="aprovarAgendamento('${doc.id}')">Aprovar</button>
      <button onclick="recusarAgendamento('${doc.id}')">Recusar</button>`;
      div.appendChild(item);
    });
  });
}

// Aprovar/Recusar
async function aprovarAgendamento(docId){ await db.collection("agendamentos").doc(docId).update({status:"confirmado"});}
async function recusarAgendamento(docId){ await db.collection("agendamentos").doc(docId).delete();}

// Modal editar
function abrirModal(docId,nome,contato,email,data,hora){
  editarDocId=docId;
  document.getElementById('editar-nome').value=nome;
  document.getElementById('editar-contato').value=contato;
  document.getElementById('editar-email').value=email;
  document.getElementById('editar-data').value=data;
  document.getElementById('editar-hora').value=hora;
  document.getElementById('modal-editar').style.display='flex';
}
function fecharModal(){ document.getElementById('modal-editar').style.display='none'; editarDocId=null; }
async function salvarEdicao(){
  if(!editarDocId) return;
  await db.collection("agendamentos").doc(editarDocId).update({
    nome:document.getElementById('editar-nome').value,
    contato:document.getElementById('editar-contato').value,
    email:document.getElementById('editar-email').value,
    data:document.getElementById('editar-data').value,
    hora:document.getElementById('editar-hora').value
  });
  fecharModal();
  carregarAgendamentosPendentes();
  carregarEventosCalendario();
}

// Gerar horários bloqueio
function gerarHorariosBloqueio(){
  const select=document.getElementById('hora-bloqueio');
  select.innerHTML="";
  let hora=9,minuto=0;
  while(hora<19||(hora===19 && minuto===0)){
    let h=hora<10?'0'+hora:hora;
    let m=minuto===0?'00':'30';
    const option=document.createElement('option');
    option.value=`${h}:${m}`;
    option.text=`${h}:${m}`;
    select.appendChild(option);
    minuto+=30;
    if(minuto===60){ minuto=0; hora++; }
  }
}

// Bloqueios
async function bloquearHorario(){ const data=document.getElementById('data-bloqueio').value; const hora=document.getElementById('hora-bloqueio').value; if(!data||!hora)return; await db.collection("agendamentos").add({data,hora,status:"bloqueado",criadoEm:new Date()}); carregarEventosCalendario(); }
async function desbloquearHorario(){ const data=document.getElementById('data-bloqueio').value; const hora=document.getElementById('hora-bloqueio').value; if(!data||!hora)return; const snap=await db.collection("agendamentos").where("data","==",data).where("hora","==",hora).where("status","==","bloqueado").get(); snap.forEach(doc=>doc.ref.delete()); carregarEventosCalendario();}
async function bloquearDiaInteiro(){ const data=document.getElementById('data-bloqueio').value; if(!data) return; let hora=9,minuto=0; const ops=[]; while(hora<19||(hora===19&&minuto===0)){ let h=hora<10?'0'+hora:hora; let m=minuto===0?'00':'30'; ops.push(db.collection("agendamentos").add({data,hora:`${h}:${m}`,status:"bloqueado",criadoEm:new Date()})); minuto+=30;if(minuto===60){ minuto=0; hora++; }} await Promise.all(ops); carregarEventosCalendario();}

// Calendário
function carregarEventosCalendario(){
  const calendarEl=document.getElementById('calendar');
  if(calendar) calendar.destroy();
  let events=[];
  db.collection("agendamentos").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const ag=doc.data();
      let color="";
      if(ag.status==="bloqueado") color="#FF4B4B";
      else if(ag.status==="pendente_pagamento") color="#FFD700";
      else color="#4BB543";
      events.push({
        title: ag.status==="bloqueado"?"Bloqueado":ag.nome,
        start: ag.data,
        allDay:true,
        backgroundColor:color,
        borderColor:"black",
        docId:doc.id
      });
    });
    calendar=new FullCalendar.Calendar(calendarEl,{
      initialView:'dayGridMonth',
      height:650,
      headerToolbar:{left:'prev,next today',center:'title',right:'dayGridMonth'},
      events:events,
      editable:true,
      eventDrop: function(info){
        const docId=info.event.extendedProps.docId;
        const novaData=info.event.startStr;
        if(docId) db.collection("agendamentos").doc(docId).update({data:novaData});
        carregarEventosCalendario();
      }
    });
    calendar.render();
  });
}
</script>
</body>
</html>
